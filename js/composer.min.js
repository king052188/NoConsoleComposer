$(document).ready(function(){
    if(app_name == "") {
        $("#app").val("No application name.");
        console_write("Application did not found.", true);
        return false;
    }
    $("#app").val(app_name);
    check();
});
function url()
{
    return 'main.php';
}
function call(func)
{
    $( "button" ).addClass("disabled");
    console_write("Please wait...", true);
    var app = $("#app").val();
    if(app.length == 0) {
        console_write("Application: No application selected -> composer " + func, false);
        console_write("Executing Aborted", false);
        $("button").removeClass('disabled');
        return false;
    }
    console_write("Application: " + app + " -> composer " + func, false);
    console_write("Executing Started", false);
    $.post('main.php',
        {
            "app": app,
            "command":func,
            "function": "command"
        },
        function(data)
        {
            console_write(data, false);
            // $("#output").append("\n===================================================================\n");
            console_write("Execution Ended", false);
            // $("#output").append("\n===================================================================\n");
            $("button").removeClass('disabled');
        }
    );
}
function check()
{
    console_write("Loading...", true);
    $.post(url(),
        {
            "function": "getStatus"
        },
        function(data) {
            if (data.composer_extracted)
            {
                console_write("Ready. All commands are available.", true);
                $("button").removeClass('disabled');
            }
            else if(data.composer)
            {
                $.post(url(),
                    {
                        "function": "extractComposer",
                    },
                    function(data) {
                        console_write(data, false);
                        window.location.reload();
                    }, 'text');
            }
            else
            {
                console_write("Please wait till composer is being installed...", true);
                $.post(url(),
                    {
                        "function": "downloadComposer",
                    },
                    function(data) {
                        console_write(data, false)
                        check();
                    }, 'text');
            }
        });
}

function console_write(message, type) {
    var date = get_date_time();

    if(type) {
        $("#output").html(date + " -> " + message + "\n");
    }
    else {
        $("#output").append(date + " -> " + message + "\n");
    }
}

function get_date_time() {
    var date = new Date().toLocaleDateString();
    var dates = date.split("/");
    var time = new Date().toLocaleTimeString();
    var m = dates[1];
    if(dates[1].length == 1) {
        m = "0" + dates[1];
    }
    var d = dates[0];
    if(dates[0].length == 1) {
        d = "0" + dates[0];
    }
    var new_date_time =  dates[2] + "-" + m + "-" + d + " " + time;
    return new_date_time;
}